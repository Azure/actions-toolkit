# Azure Actions Common libraries

## Pretext

The basic anatomy of an Azure deploy actions looks like

- Validate inputs
- Using the provided cred object, generate an access token
- Using the provided inputs, do some pre-computation to generate a payload
- Using the generated access token, make a call to an Azure endpoint to upload the payload
- Evaluates the received response and pipes it to the `stdout` stream or `stderr` stream


## Proposal

Amongst the above steps, the generation of an access token and the need for an http client are common across the actions. In order to avoid code repetition, we can pull these utilities out from the individual actions and distribute them in the form of node modules. 

## New node modules

### @azure-actions/utilities 

This node module can currently just host the http client. But eventually evolve to have more common utilties as we keep identifying them.

### @azure-actions/auth

The node module would add support to generate the access token:

- Using the SPN cred object generated by running `az ad sp create-for-rbac --sdk-auth` 
- Leveraging the context of `az login`

## Few more modules (future)
 
### @azure-actions/traceability

The cloud neutral approach for establishing traceability has been discussed here: https://github.com/github/Microsoft-Attach/pull/28 

### @azure-actions/telemetry

If the actions team doesn't have any plans for establishing telemetry, like we do in ADO tasks. We may have to build a new infra for publishing telemetry from our actions.

## Release plan

- Publish these node modules to npmjs registry
- Update any of our existing actions to use these modules. First action to use these common modules: `azure/aks-set-context`
- Add snippets in the sample action.
